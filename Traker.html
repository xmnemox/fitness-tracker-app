<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="it"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;title&gt;Fitness &amp; Diet Tracker&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;link rel="preconnect" href="https://fonts.googleapis.com"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;link rel="preconnect" href="https://fonts.gstatic.com" crossorigin&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap" rel="stylesheet"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>body {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-family: 'Inter', sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #f3f4f6;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.container {</p>
<p class="p1"><span class="Apple-converted-space">            </span>max-width: 900px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.card {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #ffffff;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 2rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-bottom: 1.5rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.input-group label {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: 600;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: #4b5563;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.input-group input, .input-group textarea, .input-group select {</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 1px solid #d1d5db;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 0.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 0.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transition: all 0.2s;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.input-group input:focus, .input-group textarea:focus, .input-group select:focus {</p>
<p class="p1"><span class="Apple-converted-space">            </span>outline: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-color: #6366f1;</p>
<p class="p1"><span class="Apple-converted-space">            </span>box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #6366f1;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: white;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 0.75rem 1.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 0.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: 600;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transition: all 0.2s;</p>
<p class="p1"><span class="Apple-converted-space">            </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: center;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn:hover {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #4f46e5;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.grid-3 {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: grid;</p>
<p class="p1"><span class="Apple-converted-space">            </span>grid-template-columns: repeat(3, 1fr);</p>
<p class="p1"><span class="Apple-converted-space">            </span>gap: 1.5rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.grid-2 {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: grid;</p>
<p class="p1"><span class="Apple-converted-space">            </span>grid-template-columns: repeat(2, 1fr);</p>
<p class="p1"><span class="Apple-converted-space">            </span>gap: 1.5rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>@media (max-width: 768px) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>.grid-3, .grid-2 {</p>
<p class="p1"><span class="Apple-converted-space">                </span>grid-template-columns: 1fr;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.message-box {</p>
<p class="p1"><span class="Apple-converted-space">            </span>position: fixed;</p>
<p class="p1"><span class="Apple-converted-space">            </span>top: 2rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>left: 50%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transform: translateX(-50%);</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 1rem 2rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 0.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>box-shadow: 0 4px 12px rgba(0,0,0,0.15);</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #4CAF50;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: white;</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>opacity: 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transition: opacity 0.5s, transform 0.5s;</p>
<p class="p1"><span class="Apple-converted-space">            </span>z-index: 1000;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.message-box.show {</p>
<p class="p1"><span class="Apple-converted-space">            </span>opacity: 1;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transform: translateX(-50%) translateY(0);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.message-box.error {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #f44336;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body class="bg-gray-100 flex justify-center items-start min-h-screen"&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Message Box --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="message-box" class="message-box"&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="container mx-auto"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;header class="text-center my-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h1 class="text-4xl font-bold text-gray-800"&gt;Fitness &amp; Diet Tracker&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;p class="text-gray-500 mt-2"&gt;Monitora i tuoi progressi fino al 21 dicembre 2025.&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;p class="text-gray-500 mt-2"&gt;ID Utente: &lt;span id="user-id" class="font-mono text-xs text-gray-600 bg-gray-200 px-2 py-1 rounded-full"&gt;Caricamento...&lt;/span&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/header&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Impostazioni Utente Section --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h2 class="text-2xl font-bold text-gray-700 mb-4"&gt;Impostazioni Utente&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="grid grid-cols-1 md:grid-cols-2 gap-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;!-- Altezza --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;div class="input-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                     </span>&lt;label for="altezza"&gt;Altezza (cm):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                     </span>&lt;input type="number" id="altezza" step="1" placeholder="Es. 175"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;div class="input-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                     </span>&lt;label for="dailyWaterGoal"&gt;Obiettivo Acqua (L):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                     </span>&lt;input type="number" id="dailyWaterGoal" step="0.1" placeholder="Es. 2.0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;div class="input-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                     </span>&lt;label for="dailyCaloriesGoal"&gt;Obiettivo Calorie (kcal):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                     </span>&lt;input type="number" id="dailyCaloriesGoal" placeholder="Es. 2000"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;div class="input-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                     </span>&lt;label for="dailyProteinGoal"&gt;Obiettivo Proteine (g):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                     </span>&lt;input type="number" id="dailyProteinGoal" placeholder="Es. 150"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">             </span>&lt;div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6 mt-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;div class="input-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                     </span>&lt;label for="dailyCarbsGoal"&gt;Obiettivo Carboidrati (g):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                     </span>&lt;input type="number" id="dailyCarbsGoal" placeholder="Es. 220"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;div class="input-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                     </span>&lt;label for="dailyFatsGoal"&gt;Obiettivo Grassi (g):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                     </span>&lt;input type="number" id="dailyFatsGoal" placeholder="Es. 70"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button id="save-settings-btn" class="btn w-full mt-6"&gt;Salva Impostazioni&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Obiettivi e Progressi Section --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h2 class="text-2xl font-bold text-gray-700 mb-4"&gt;Obiettivi e Progressi&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="grid grid-cols-1 md:grid-cols-2 gap-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;div class="input-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label&gt;Aderenza settimanale peso (-0.5kg/settimana):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span id="weekly-adherence" class="block w-full text-center py-2 px-3 bg-gray-100 text-gray-600 rounded-md"&gt;--&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;div class="input-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label&gt;Raggiungimento obiettivo totale (-7kg):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span id="total-progress" class="block w-full text-center py-2 px-3 bg-gray-100 text-gray-600 rounded-md"&gt;--&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button id="get-summary-btn" class="btn w-full mt-6 flex items-center justify-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>Ottieni un'Analisi Personalizzata ✨</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Analisi AI Section --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="card hidden" id="ai-summary-card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h2 class="text-2xl font-bold text-gray-700 mb-4"&gt;La tua Analisi ✨&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="ai-summary-content" class="text-gray-600 text-base leading-relaxed"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;!-- AI summary will be displayed here --&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Dati Giornalieri Section --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h2 class="text-2xl font-bold text-gray-700 mb-4"&gt;Dati Giornalieri&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;label for="date-picker" class="block text-sm font-medium text-gray-700 mb-1"&gt;Seleziona Data:&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;input type="date" id="date-picker" class="w-full"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="grid md:grid-cols-3 gap-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;!-- Composizione Corporea --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="col-span-1 border-r border-gray-200 pr-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;h3 class="text-xl font-semibold text-gray-700 mb-3"&gt;Composizione Corporea&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="input-group mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="peso"&gt;Peso (kg):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="number" id="peso" step="0.1" placeholder="Es. 75.5"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="input-group mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label&gt;BMI/IMC:&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;span id="bmi" class="block w-full text-center py-2 px-3 bg-gray-100 text-gray-600 rounded-md"&gt;--&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="input-group mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="massa-grassa-perc"&gt;Massa Grassa (%):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="number" id="massa-grassa-perc" step="0.1" placeholder="Es. 15.2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="input-group mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label&gt;Massa Grassa (kg):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;span id="massa-grassa-kg" class="block w-full text-center py-2 px-3 bg-gray-100 text-gray-600 rounded-md"&gt;--&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="input-group mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="massa-magra-perc"&gt;Massa Magra (%):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="number" id="massa-magra-perc" step="0.1" placeholder="Es. 80.5"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="input-group mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label&gt;Massa Magra (kg):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;span id="massa-magra-kg" class="block w-full text-center py-2 px-3 bg-gray-100 text-gray-600 rounded-md"&gt;--&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="input-group mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="massa-ossea-perc"&gt;Massa Ossea (%):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="number" id="massa-ossea-perc" step="0.1" placeholder="Es. 4.3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="input-group mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label&gt;Massa Ossea (kg):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;span id="massa-ossea-kg" class="block w-full text-center py-2 px-3 bg-gray-100 text-gray-600 rounded-md"&gt;--&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="input-group mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="massa-acqua-perc"&gt;Massa Acqua (%):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="number" id="massa-acqua-perc" step="0.1" placeholder="Es. 55.7"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="input-group mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label&gt;Massa Acqua (kg):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;span id="massa-acqua-kg" class="block w-full text-center py-2 px-3 bg-gray-100 text-gray-600 rounded-md"&gt;--&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;!-- Allenamento --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="col-span-1 border-r border-gray-200 pr-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;h3 class="text-xl font-semibold text-gray-700 mb-3"&gt;Allenamento&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="input-group mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="esercizio-tipo"&gt;Tipo di esercizio:&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;select id="esercizio-tipo" class="w-full"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;option value=""&gt;Seleziona...&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;option value="Biking"&gt;Biking&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;option value="Running"&gt;Running&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;option value="HIIT"&gt;HIIT&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;option value="Riposo"&gt;Riposo&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;option value="Corpo Libero"&gt;Corpo Libero&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;option value="Camminata"&gt;Camminata&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="input-group mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="esercizio-tempo"&gt;Tempo (min):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="number" id="esercizio-tempo" placeholder="Es. 30"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="input-group mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="intensita-percepita"&gt;Intensità percepita (1-10):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="number" id="intensita-percepita" min="1" max="10" placeholder="Es. 7"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="input-group mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="esercizio-quantita"&gt;Dettagli specifici:&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;textarea id="esercizio-quantita" rows="2" placeholder="Es. 5 km, 15 push-up, 3 giri"&gt;&lt;/textarea&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="input-group flex items-center mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="checkbox" id="creatina" class="h-5 w-5 rounded-md text-indigo-600 focus:ring-indigo-500"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="creatina" class="ml-2 font-semibold text-sm"&gt;Ho preso la creatina&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;!-- Nutrizione - Obiettivi --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="col-span-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;h3 class="text-xl font-semibold text-gray-700 mb-3"&gt;Nutrizione - Obiettivi&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="input-group mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="calorie"&gt;Calorie totali (kcal):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="number" id="calorie" placeholder="Es. 2000"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;span class="text-xs text-gray-500" id="kcal-perc"&gt;--% raggiunto&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="input-group mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="proteine"&gt;Proteine (g):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="number" id="proteine" placeholder="Es. 150"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;span class="text-xs text-gray-500" id="protein-perc"&gt;--% raggiunto&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="input-group mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="carboidrati"&gt;Carboidrati (g):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="number" id="carboidrati" placeholder="Es. 220"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;span class="text-xs text-gray-500" id="carbs-perc"&gt;--% raggiunto&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="input-group mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="grassi"&gt;Grassi (g):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="number" id="grassi" placeholder="Es. 70"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;span class="text-xs text-gray-500" id="fats-perc"&gt;--% raggiunto&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="input-group mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="litri-bevuti"&gt;Acqua bevuta (L):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="number" id="litri-bevuti" step="0.1" placeholder="Es. 2.5"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;span class="text-xs text-gray-500" id="water-perc"&gt;--% raggiunto&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;!-- Note Giornaliere --&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="input-group mt-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;h3 class="text-xl font-semibold text-gray-700 mb-3"&gt;Note Giornaliere&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;textarea id="note-personali" rows="4" maxlength="500" class="resize-none" placeholder="Es. Oggi mi sento energico, ho dormito bene, dolore alla schiena migliorato..."&gt;&lt;/textarea&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;span id="caratteri-rimanenti" class="text-xs text-gray-500"&gt;Caratteri rimanenti: 500&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="flex justify-between items-center mt-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;button id="save-daily-btn" class="btn w-full mr-2"&gt;Salva Dati del Giorno&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;button id="reset-form-btn" class="btn w-full ml-2 bg-gray-500 hover:bg-gray-600"&gt;Reset Form&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Riepilogo Settimanale Section --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h2 class="text-2xl font-bold text-gray-700 mb-4"&gt;Riepilogo Settimanale&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="grid grid-cols-1 md:grid-cols-2 gap-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;div class="input-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label for="cm-vita"&gt;Vita (cm):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;input type="number" id="cm-vita" step="0.1" placeholder="Es. 80.5"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;div class="input-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label for="cm-fianchi"&gt;Fianchi (cm):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;input type="number" id="cm-fianchi" step="0.1" placeholder="Es. 95"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;div class="input-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label for="cm-braccio"&gt;Braccio (cm):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;input type="number" id="cm-braccio" step="0.1" placeholder="Es. 32"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;div class="input-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label for="cm-coscia"&gt;Coscia (cm):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;input type="number" id="cm-coscia" step="0.1" placeholder="Es. 55"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;div class="input-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label for="kcal-basale"&gt;Metabolismo Basale (kcal):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;input type="number" id="kcal-basale" placeholder="Es. 1600"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;div class="input-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label for="bpm-riposo"&gt;Frequenza Cardiaca a Riposo (bpm):&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;input type="number" id="bpm-riposo" placeholder="Es. 65"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button id="save-weekly-btn" class="btn w-full mt-6"&gt;Salva Riepilogo Settimanale&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Trend Charts Section --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h2 class="text-2xl font-bold text-gray-700 mb-4"&gt;Grafici di Tendenza&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="space-y-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;h3 class="text-xl font-semibold text-gray-700 mb-2"&gt;Peso, Massa Grassa e Massa Magra&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;canvas id="weight-chart"&gt;&lt;/canvas&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;h3 class="text-xl font-semibold text-gray-700 mb-2"&gt;Dieta e Obiettivi&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;canvas id="diet-chart"&gt;&lt;/canvas&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Storico Dati --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h2 class="text-2xl font-bold text-gray-700 mb-4"&gt;Storico Dati&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;p id="loading-history" class="text-gray-500"&gt;Caricamento dati...&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="history-container" class="mt-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;!-- Dati storici verranno inseriti qui --&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Firebase SDKs --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script type="module"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";</p>
<p class="p1"><span class="Apple-converted-space">        </span>import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";</p>
<p class="p1"><span class="Apple-converted-space">        </span>import { getFirestore, doc, getDoc, setDoc, onSnapshot, collection, query, addDoc, getDocs, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";</p>
<p class="p1"><span class="Apple-converted-space">        </span>import Chart from 'https://cdn.jsdelivr.net/npm/chart.js';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Variabili globali fornite dall'ambiente, con fallback per l'uso locale</p>
<p class="p1"><span class="Apple-converted-space">        </span>const appId = 'your-app-id';</p>
<p class="p1"><span class="Apple-converted-space">        </span>const firebaseConfig = {</p>
<p class="p1"><span class="Apple-converted-space">            </span>apiKey: "your-api-key",</p>
<p class="p1"><span class="Apple-converted-space">            </span>authDomain: "your-auth-domain",</p>
<p class="p1"><span class="Apple-converted-space">            </span>projectId: "your-project-id",</p>
<p class="p1"><span class="Apple-converted-space">            </span>storageBucket: "your-storage-bucket",</p>
<p class="p1"><span class="Apple-converted-space">            </span>messagingSenderId: "your-messaging-sender-id",</p>
<p class="p1"><span class="Apple-converted-space">            </span>appId: "your-app-id"</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p1"><span class="Apple-converted-space">        </span>const initialAuthToken = null;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>let app;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let db;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let auth;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let userId = null;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let userHeight = null;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let initialWeight = null;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let dailyWaterGoal = null;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let dailyCaloriesGoal = null;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let dailyProteinGoal = null;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let dailyCarbsGoal = null;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let dailyFatsGoal = null;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Total goal: -7kg by Dec 21, 2025</p>
<p class="p1"><span class="Apple-converted-space">        </span>const targetWeightLoss = 7;</p>
<p class="p1"><span class="Apple-converted-space">        </span>const targetDate = new Date('2025-12-21');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const weeklyWeightLossTarget = 0.5;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>let selectedDate = new Date().toISOString().slice(0, 10);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('date-picker').value = selectedDate;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>const datePicker = document.getElementById('date-picker');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const saveDailyBtn = document.getElementById('save-daily-btn');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const saveWeeklyBtn = document.getElementById('save-weekly-btn');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const saveSettingsBtn = document.getElementById('save-settings-btn');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const resetFormBtn = document.getElementById('reset-form-btn');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const userIdDisplay = document.getElementById('user-id');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const loadingHistory = document.getElementById('loading-history');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const historyContainer = document.getElementById('history-container');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const messageBox = document.getElementById('message-box');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const getSummaryBtn = document.getElementById('get-summary-btn');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const aiSummaryCard = document.getElementById('ai-summary-card');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const aiSummaryContent = document.getElementById('ai-summary-content');</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>const altezzaInput = document.getElementById('altezza');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const pesoInput = document.getElementById('peso');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const bmiSpan = document.getElementById('bmi');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const massaGrassaPercInput = document.getElementById('massa-grassa-perc');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const massaGrassaKgSpan = document.getElementById('massa-grassa-kg');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const massaMagraPercInput = document.getElementById('massa-magra-perc');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const massaMagraKgSpan = document.getElementById('massa-magra-kg');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const massaOsseaPercInput = document.getElementById('massa-ossea-perc');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const massaOsseaKgSpan = document.getElementById('massa-ossea-kg');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const massaAcquaPercInput = document.getElementById('massa-acqua-perc');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const massaAcquaKgSpan = document.getElementById('massa-acqua-kg');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>const dailyWaterGoalInput = document.getElementById('dailyWaterGoal');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const dailyCaloriesGoalInput = document.getElementById('dailyCaloriesGoal');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const dailyProteinGoalInput = document.getElementById('dailyProteinGoal');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const dailyCarbsGoalInput = document.getElementById('dailyCarbsGoal');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const dailyFatsGoalInput = document.getElementById('dailyFatsGoal');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const weeklyAdherenceSpan = document.getElementById('weekly-adherence');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const totalProgressSpan = document.getElementById('total-progress');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>const notePersonaliTextarea = document.getElementById('note-personali');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const caratteriRimanentiSpan = document.getElementById('caratteri-rimanenti');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const intensitaPercepitaInput = document.getElementById('intensita-percepita');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const kcalPercSpan = document.getElementById('kcal-perc');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const proteinPercSpan = document.getElementById('protein-perc');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const carbsPercSpan = document.getElementById('carbs-perc');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const fatsPercSpan = document.getElementById('fats-perc');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const waterPercSpan = document.getElementById('water-perc');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>let weightChart, dietChart;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Funzione per mostrare un messaggio temporaneo</p>
<p class="p1"><span class="Apple-converted-space">        </span>function showMessage(message, isError = false) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>messageBox.textContent = message;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (isError) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>messageBox.classList.add('error');</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                </span>messageBox.classList.remove('error');</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>messageBox.classList.add('show');</p>
<p class="p1"><span class="Apple-converted-space">            </span>setTimeout(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>messageBox.classList.remove('show');</p>
<p class="p1"><span class="Apple-converted-space">            </span>}, 3000);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>function updateGoalPercentages() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const calorie = parseInt(document.getElementById('calorie').value) || 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const proteine = parseInt(document.getElementById('proteine').value) || 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const carboidrati = parseInt(document.getElementById('carboidrati').value) || 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const grassi = parseInt(document.getElementById('grassi').value) || 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const litriBevuti = parseFloat(document.getElementById('litri-bevuti').value) || 0;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>kcalPercSpan.textContent = dailyCaloriesGoal ? `${((calorie / dailyCaloriesGoal) * 100).toFixed(1)}% raggiunto` : '--% raggiunto';</p>
<p class="p1"><span class="Apple-converted-space">            </span>proteinPercSpan.textContent = dailyProteinGoal ? `${((proteine / dailyProteinGoal) * 100).toFixed(1)}% raggiunto` : '--% raggiunto';</p>
<p class="p1"><span class="Apple-converted-space">            </span>carbsPercSpan.textContent = dailyCarbsGoal ? `${((carboidrati / dailyCarbsGoal) * 100).toFixed(1)}% raggiunto` : '--% raggiunto';</p>
<p class="p1"><span class="Apple-converted-space">            </span>fatsPercSpan.textContent = dailyFatsGoal ? `${((grassi / dailyFatsGoal) * 100).toFixed(1)}% raggiunto` : '--% raggiunto';</p>
<p class="p1"><span class="Apple-converted-space">            </span>waterPercSpan.textContent = dailyWaterGoal ? `${((litriBevuti / dailyWaterGoal) * 100).toFixed(1)}% raggiunto` : '--% raggiunto';</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Funzione per calcolare BMI e masse in kg</p>
<p class="p1"><span class="Apple-converted-space">        </span>function updateCalculations() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const peso = parseFloat(pesoInput.value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const altezza = userHeight; // Usa l'altezza salvata</p>
<p class="p1"><span class="Apple-converted-space">            </span>const massaGrassaPerc = parseFloat(massaGrassaPercInput.value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const massaMagraPerc = parseFloat(massaMagraPercInput.value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const massaOsseaPerc = parseFloat(massaOsseaPercInput.value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const massaAcquaPerc = parseFloat(massaAcquaPercInput.value);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Calcolo BMI</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (peso &gt; 0 &amp;&amp; altezza &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const altezzaM = altezza / 100;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const bmi = peso / (altezzaM * altezzaM);</p>
<p class="p1"><span class="Apple-converted-space">                </span>bmiSpan.textContent = bmi.toFixed(2);</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                </span>bmiSpan.textContent = "--";</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Calcolo masse in kg</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (peso &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>massaGrassaKgSpan.textContent = massaGrassaPerc ? (peso * massaGrassaPerc / 100).toFixed(2) : '--';</p>
<p class="p1"><span class="Apple-converted-space">                </span>massaMagraKgSpan.textContent = massaMagraPerc ? (peso * massaMagraPerc / 100).toFixed(2) : '--';</p>
<p class="p1"><span class="Apple-converted-space">                </span>massaOsseaKgSpan.textContent = massaOsseaPerc ? (peso * massaOsseaPerc / 100).toFixed(2) : '--';</p>
<p class="p1"><span class="Apple-converted-space">                </span>massaAcquaKgSpan.textContent = massaAcquaPerc ? (peso * massaAcquaPerc / 100).toFixed(2) : '--';</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                </span>massaGrassaKgSpan.textContent = massaMagraKgSpan.textContent = massaOsseaKgSpan.textContent = massaAcquaKgSpan.textContent = '--';</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>updateGoalPercentages();</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Listener per gli input che influenzano i calcoli</p>
<p class="p1"><span class="Apple-converted-space">        </span>pesoInput.addEventListener('input', updateCalculations);</p>
<p class="p1"><span class="Apple-converted-space">        </span>massaGrassaPercInput.addEventListener('input', updateCalculations);</p>
<p class="p1"><span class="Apple-converted-space">        </span>massaMagraPercInput.addEventListener('input', updateCalculations);</p>
<p class="p1"><span class="Apple-converted-space">        </span>massaOsseaPercInput.addEventListener('input', updateCalculations);</p>
<p class="p1"><span class="Apple-converted-space">        </span>massaAcquaPercInput.addEventListener('input', updateCalculations);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('calorie').addEventListener('input', updateGoalPercentages);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('proteine').addEventListener('input', updateGoalPercentages);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('carboidrati').addEventListener('input', updateGoalPercentages);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('grassi').addEventListener('input', updateGoalPercentages);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('litri-bevuti').addEventListener('input', updateGoalPercentages);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Funzione per resettare il form</p>
<p class="p1"><span class="Apple-converted-space">        </span>resetFormBtn.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">             </span>document.querySelectorAll('.card input, .card textarea, .card select').forEach(input =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (input.type === 'checkbox') input.checked = false;</p>
<p class="p1"><span class="Apple-converted-space">                </span>else input.value = '';</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>updateCalculations();</p>
<p class="p1"><span class="Apple-converted-space">            </span>showMessage("Form resettato!");</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Funzione per aggiornare il conteggio caratteri delle note</p>
<p class="p1"><span class="Apple-converted-space">        </span>notePersonaliTextarea.addEventListener('input', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const maxLength = 500;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const currentLength = notePersonaliTextarea.value.length;</p>
<p class="p1"><span class="Apple-converted-space">            </span>caratteriRimanentiSpan.textContent = `Caratteri rimanenti: ${maxLength - currentLength}`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Funzione per recuperare i dati giornalieri per una data specifica</p>
<p class="p1"><span class="Apple-converted-space">        </span>async function fetchDailyDataForDate(date) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!auth.currentUser) return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const docRef = doc(db, `artifacts/${appId}/users/${auth.currentUser.uid}/dailyEntries`, date);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const docSnap = await getDoc(docRef);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>if (docSnap.exists()) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const data = docSnap.data();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('peso').value = data.peso || '';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('creatina').checked = data.creatina || false;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('massa-grassa-perc').value = data.massaGrassa.perc || '';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('massa-magra-perc').value = data.massaMagra.perc || '';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('massa-ossea-perc').value = data.massaOssea.perc || '';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('massa-acqua-perc').value = data.massaAcqua.perc || '';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('esercizio-tipo').value = data.esercizio.tipo || '';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('esercizio-tempo').value = data.esercizio.tempo || '';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>intensitaPercepitaInput.value = data.esercizio.intensita || '';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('esercizio-quantita').value = data.esercizio.quantita || '';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('calorie').value = data.dieta.calorie || '';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('grassi').value = data.dieta.grassi || '';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('proteine').value = data.dieta.proteine || '';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('carboidrati').value = data.dieta.carboidrati || '';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('litri-bevuti').value = data.dieta.litriBevuti || '';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>notePersonaliTextarea.value = data.notePersonali || '';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>caratteriRimanentiSpan.textContent = `Caratteri rimanenti: ${500 - notePersonaliTextarea.value.length}`;</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>updateCalculations();</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Pulisce il form se non ci sono dati per la data</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.querySelectorAll('.card input, .card textarea, .card select').forEach(input =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (input.type === 'checkbox') input.checked = false;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>else input.value = '';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>});</p>
<p class="p1"><span class="Apple-converted-space">                    </span>updateCalculations();</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.error("Errore nel caricare i dati giornalieri:", error);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Listener per il cambio data</p>
<p class="p1"><span class="Apple-converted-space">        </span>datePicker.addEventListener('change', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>selectedDate = e.target.value;</p>
<p class="p1"><span class="Apple-converted-space">            </span>fetchDailyDataForDate(selectedDate);</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Salva i dati giornalieri</p>
<p class="p1"><span class="Apple-converted-space">        </span>saveDailyBtn.addEventListener('click', async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!auth.currentUser) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>showMessage("Attendere l'autenticazione.", true);</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>const data = {</p>
<p class="p1"><span class="Apple-converted-space">                </span>data: selectedDate,</p>
<p class="p1"><span class="Apple-converted-space">                </span>peso: parseFloat(document.getElementById('peso').value) || null,</p>
<p class="p1"><span class="Apple-converted-space">                </span>creatina: document.getElementById('creatina').checked,</p>
<p class="p1"><span class="Apple-converted-space">                </span>altezza: userHeight,</p>
<p class="p1"><span class="Apple-converted-space">                </span>massaGrassa: {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>perc: parseFloat(document.getElementById('massa-grassa-perc').value) || null,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>kg: parseFloat(massaGrassaKgSpan.textContent) || null</p>
<p class="p1"><span class="Apple-converted-space">                </span>},</p>
<p class="p1"><span class="Apple-converted-space">                </span>massaMagra: {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>perc: parseFloat(document.getElementById('massa-magra-perc').value) || null,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>kg: parseFloat(massaMagraKgSpan.textContent) || null</p>
<p class="p1"><span class="Apple-converted-space">                </span>},</p>
<p class="p1"><span class="Apple-converted-space">                </span>massaOssea: {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>perc: parseFloat(document.getElementById('massa-ossea-perc').value) || null,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>kg: parseFloat(massaOsseaKgSpan.textContent) || null</p>
<p class="p1"><span class="Apple-converted-space">                </span>},</p>
<p class="p1"><span class="Apple-converted-space">                </span>massaAcqua: {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>perc: parseFloat(document.getElementById('massa-acqua-perc').value) || null,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>kg: parseFloat(massaAcquaKgSpan.textContent) || null</p>
<p class="p1"><span class="Apple-converted-space">                </span>},</p>
<p class="p1"><span class="Apple-converted-space">                </span>esercizio: {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>tipo: document.getElementById('esercizio-tipo').value.trim() || null,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>tempo: parseInt(document.getElementById('esercizio-tempo').value) || null,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>intensita: parseInt(intensitaPercepitaInput.value) || null,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>quantita: document.getElementById('esercizio-quantita').value.trim() || null</p>
<p class="p1"><span class="Apple-converted-space">                </span>},</p>
<p class="p1"><span class="Apple-converted-space">                </span>dieta: {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>calorie: parseInt(document.getElementById('calorie').value) || null,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>grassi: parseInt(document.getElementById('grassi').value) || null,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>proteine: parseInt(document.getElementById('proteine').value) || null,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>carboidrati: parseInt(document.getElementById('carboidrati').value) || null,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>litriBevuti: parseFloat(document.getElementById('litri-bevuti').value) || null</p>
<p class="p1"><span class="Apple-converted-space">                </span>},</p>
<p class="p1"><span class="Apple-converted-space">                </span>notePersonali: notePersonaliTextarea.value.trim() || null</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const docRef = doc(db, `artifacts/${appId}/users/${auth.currentUser.uid}/dailyEntries`, selectedDate);</p>
<p class="p1"><span class="Apple-converted-space">            </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                </span>await setDoc(docRef, data, { merge: true });</p>
<p class="p1"><span class="Apple-converted-space">                </span>showMessage("Dati giornalieri salvati con successo!");</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Check and set initial weight if it's the first entry with a weight value</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (initialWeight === null &amp;&amp; data.peso !== null) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const settingsDocRef = doc(db, `artifacts/${appId}/users/${auth.currentUser.uid}/settings`, 'userProfile');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>await setDoc(settingsDocRef, { initialWeight: data.peso }, { merge: true });</p>
<p class="p1"><span class="Apple-converted-space">                    </span>initialWeight = data.peso;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.log(`Initial weight set to: ${initialWeight}kg`);</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.error("Errore nel salvare i dati giornalieri:", error);</p>
<p class="p1"><span class="Apple-converted-space">                </span>showMessage("Errore nel salvare i dati.", true);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Salva le impostazioni dell'utente</p>
<p class="p1"><span class="Apple-converted-space">        </span>saveSettingsBtn.addEventListener('click', async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!auth.currentUser) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>showMessage("Attendere l'autenticazione.", true);</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>const altezza = parseFloat(altezzaInput.value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const waterGoal = parseFloat(dailyWaterGoalInput.value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const caloriesGoal = parseInt(dailyCaloriesGoalInput.value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const proteinGoal = parseInt(dailyProteinGoalInput.value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const carbsGoal = parseInt(dailyCarbsGoalInput.value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const fatsGoal = parseInt(dailyFatsGoalInput.value);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const settings = {};</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!isNaN(altezza) &amp;&amp; altezza &gt; 0) settings.altezza = altezza;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!isNaN(waterGoal) &amp;&amp; waterGoal &gt;= 0) settings.dailyWaterGoal = waterGoal;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!isNaN(caloriesGoal) &amp;&amp; caloriesGoal &gt;= 0) settings.dailyCaloriesGoal = caloriesGoal;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!isNaN(proteinGoal) &amp;&amp; proteinGoal &gt;= 0) settings.dailyProteinGoal = proteinGoal;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!isNaN(carbsGoal) &amp;&amp; carbsGoal &gt;= 0) settings.dailyCarbsGoal = carbsGoal;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!isNaN(fatsGoal) &amp;&amp; fatsGoal &gt;= 0) settings.dailyFatsGoal = fatsGoal;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (Object.keys(settings).length === 0) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>showMessage("Inserisci almeno un valore valido.", true);</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const settingsDocRef = doc(db, `artifacts/${appId}/users/${auth.currentUser.uid}/settings`, 'userProfile');</p>
<p class="p1"><span class="Apple-converted-space">                </span>await setDoc(settingsDocRef, settings, { merge: true });</p>
<p class="p1"><span class="Apple-converted-space">                </span>userHeight = settings.altezza !== undefined ? settings.altezza : userHeight;</p>
<p class="p1"><span class="Apple-converted-space">                </span>dailyWaterGoal = settings.dailyWaterGoal !== undefined ? settings.dailyWaterGoal : dailyWaterGoal;</p>
<p class="p1"><span class="Apple-converted-space">                </span>dailyCaloriesGoal = settings.dailyCaloriesGoal !== undefined ? settings.dailyCaloriesGoal : dailyCaloriesGoal;</p>
<p class="p1"><span class="Apple-converted-space">                </span>dailyProteinGoal = settings.dailyProteinGoal !== undefined ? settings.dailyProteinGoal : dailyProteinGoal;</p>
<p class="p1"><span class="Apple-converted-space">                </span>dailyCarbsGoal = settings.dailyCarbsGoal !== undefined ? settings.dailyCarbsGoal : dailyCarbsGoal;</p>
<p class="p1"><span class="Apple-converted-space">                </span>dailyFatsGoal = settings.dailyFatsGoal !== undefined ? settings.dailyFatsGoal : dailyFatsGoal;</p>
<p class="p1"><span class="Apple-converted-space">                </span>updateCalculations();</p>
<p class="p1"><span class="Apple-converted-space">                </span>showMessage("Impostazioni salvate con successo!");</p>
<p class="p1"><span class="Apple-converted-space">            </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.error("Errore nel salvare le impostazioni:", error);</p>
<p class="p1"><span class="Apple-converted-space">                </span>showMessage("Errore nel salvare le impostazioni.", true);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Salva i dati settimanali</p>
<p class="p1"><span class="Apple-converted-space">        </span>saveWeeklyBtn.addEventListener('click', async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">             </span>if (!auth.currentUser) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>showMessage("Attendere l'autenticazione.", true);</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>const data = {</p>
<p class="p1"><span class="Apple-converted-space">                </span>data: new Date().toISOString().slice(0, 10),</p>
<p class="p1"><span class="Apple-converted-space">                </span>misureCorpo: {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>vita: parseFloat(document.getElementById('cm-vita').value) || null,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>fianchi: parseFloat(document.getElementById('cm-fianchi').value) || null,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>braccio: parseFloat(document.getElementById('cm-braccio').value) || null,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>coscia: parseFloat(document.getElementById('cm-coscia').value) || null</p>
<p class="p1"><span class="Apple-converted-space">                </span>},</p>
<p class="p1"><span class="Apple-converted-space">                </span>metabolismoBasale: parseFloat(document.getElementById('kcal-basale').value) || null,</p>
<p class="p1"><span class="Apple-converted-space">                </span>frequenzaCardiacaRiposo: parseInt(document.getElementById('bpm-riposo').value) || null</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const weeklyCollectionRef = collection(db, `artifacts/${appId}/users/${auth.currentUser.uid}/weeklySummaries`);</p>
<p class="p1"><span class="Apple-converted-space">                </span>await addDoc(weeklyCollectionRef, data);</p>
<p class="p1"><span class="Apple-converted-space">                </span>showMessage("Riepilogo settimanale salvato con successo!");</p>
<p class="p1"><span class="Apple-converted-space">            </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.error("Errore nel salvare il riepilogo settimanale:", error);</p>
<p class="p1"><span class="Apple-converted-space">                </span>showMessage("Errore nel salvare il riepilogo.", true);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Funzione per calcolare e mostrare i progressi generali</p>
<p class="p1"><span class="Apple-converted-space">        </span>function updateOverallProgress(history) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (history.length === 0 || initialWeight === null) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>weeklyAdherenceSpan.textContent = '--';</p>
<p class="p1"><span class="Apple-converted-space">                </span>totalProgressSpan.textContent = '--';</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const sortedHistory = history.sort((a, b) =&gt; new Date(a.data) - new Date(b.data));</p>
<p class="p1"><span class="Apple-converted-space">            </span>const firstEntry = sortedHistory.find(d =&gt; d.peso !== null);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const lastEntry = sortedHistory.slice().reverse().find(d =&gt; d.peso !== null);</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!firstEntry || !lastEntry) {</p>
<p class="p1"><span class="Apple-converted-space">                 </span>weeklyAdherenceSpan.textContent = '--';</p>
<p class="p1"><span class="Apple-converted-space">                 </span>totalProgressSpan.textContent = '--';</p>
<p class="p1"><span class="Apple-converted-space">                 </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>const currentWeight = lastEntry.peso;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Calcolo progresso totale</p>
<p class="p1"><span class="Apple-converted-space">            </span>const weightLost = initialWeight - currentWeight;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const totalProgress = (weightLost / targetWeightLoss) * 100;</p>
<p class="p1"><span class="Apple-converted-space">            </span>totalProgressSpan.textContent = `${totalProgress.toFixed(1)}%`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Calcolo aderenza settimanale</p>
<p class="p1"><span class="Apple-converted-space">            </span>const today = new Date();</p>
<p class="p1"><span class="Apple-converted-space">            </span>const firstDate = new Date(firstEntry.data);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const daysPassed = (today - firstDate) / (1000 * 60 * 60 * 24);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const weeksPassed = daysPassed / 7;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const targetLossThisWeek = weeksPassed &gt; 0 ? weeklyWeightLossTarget : 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const weeklyLoss = initialWeight - currentWeight;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>let weeklyAdherence = 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (targetLossThisWeek &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                 </span>weeklyAdherence = (weeklyLoss / (weeksPassed * weeklyWeightLossTarget)) * 100;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>weeklyAdherenceSpan.textContent = `${weeklyAdherence.toFixed(1)}%`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Ascolta gli aggiornamenti in tempo reale sui dati giornalieri</p>
<p class="p1"><span class="Apple-converted-space">        </span>function setupDailyDataListener() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!auth.currentUser) return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const collectionRef = collection(db, `artifacts/${appId}/users/${auth.currentUser.uid}/dailyEntries`);</p>
<p class="p1"><span class="Apple-converted-space">            </span>onSnapshot(collectionRef, (snapshot) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const history = [];</p>
<p class="p1"><span class="Apple-converted-space">                </span>snapshot.forEach(doc =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>history.push(doc.data());</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Ordina per data decrescente</p>
<p class="p1"><span class="Apple-converted-space">                </span>history.sort((a, b) =&gt; new Date(b.data) - new Date(a.data));</p>
<p class="p1"><span class="Apple-converted-space">                </span>renderHistory(history);</p>
<p class="p1"><span class="Apple-converted-space">                </span>updateOverallProgress(history);</p>
<p class="p1"><span class="Apple-converted-space">                </span>updateCharts(history);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}, (error) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.error("Errore nel listener dei dati giornalieri:", error);</p>
<p class="p1"><span class="Apple-converted-space">                </span>loadingHistory.textContent = "Errore nel caricare lo storico.";</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">         </span>// Ascolta gli aggiornamenti in tempo reale sui dati settimanali</p>
<p class="p1"><span class="Apple-converted-space">        </span>function setupWeeklyDataListener() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!auth.currentUser) return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const collectionRef = collection(db, `artifacts/${appId}/users/${auth.currentUser.uid}/weeklySummaries`);</p>
<p class="p1"><span class="Apple-converted-space">            </span>onSnapshot(collectionRef, (snapshot) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>snapshot.docChanges().forEach(change =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (change.type === "added") {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>console.log("Nuovo riepilogo settimanale aggiunto:", change.doc.data());</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>}, (error) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                 </span>console.error("Errore nel listener dei dati settimanali:", error);</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Renderizza i dati storici</p>
<p class="p1"><span class="Apple-converted-space">        </span>function renderHistory(data) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (data.length === 0) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>historyContainer.innerHTML = '&lt;p class="text-gray-500"&gt;Nessun dato storico trovato. Salva i tuoi progressi!&lt;/p&gt;';</p>
<p class="p1"><span class="Apple-converted-space">                </span>loadingHistory.style.display = 'none';</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>loadingHistory.style.display = 'none';</p>
<p class="p1"><span class="Apple-converted-space">            </span>historyContainer.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">            </span>data.forEach(item =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>// Calcola le percentuali di raggiungimento obiettivi giornalieri</p>
<p class="p1"><span class="Apple-converted-space">                </span>const waterPerc = dailyWaterGoal ? (item.dieta.litriBevuti / dailyWaterGoal) * 100 : '--';</p>
<p class="p1"><span class="Apple-converted-space">                </span>const kcalPerc = dailyCaloriesGoal ? (item.dieta.calorie / dailyCaloriesGoal) * 100 : '--';</p>
<p class="p1"><span class="Apple-converted-space">                </span>const proteinPerc = dailyProteinGoal ? (item.dieta.proteine / dailyProteinGoal) * 100 : '--';</p>
<p class="p1"><span class="Apple-converted-space">                </span>const carbsPerc = dailyCarbsGoal ? (item.dieta.carboidrati / dailyCarbsGoal) * 100 : '--';</p>
<p class="p1"><span class="Apple-converted-space">                </span>const fatsPerc = dailyFatsGoal ? (item.dieta.grassi / dailyFatsGoal) * 100 : '--';</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>const dayCard = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">                </span>dayCard.className = 'card bg-gray-50 p-4 mb-4';</p>
<p class="p1"><span class="Apple-converted-space">                </span>dayCard.innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;h4 class="text-lg font-semibold text-gray-800 mb-2"&gt;Dati del ${item.data}&lt;/h4&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;ul class="text-sm text-gray-600 space-y-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;&lt;strong&gt;Peso:&lt;/strong&gt; ${item.peso !== null ? item.peso + ' kg' : '--'}&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;&lt;strong&gt;BMI:&lt;/strong&gt; ${userHeight &amp;&amp; item.peso !== null ? (item.peso / ((userHeight / 100) * (userHeight / 100))).toFixed(2) : '--'}&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;&lt;strong&gt;Massa Grassa:&lt;/strong&gt; ${item.massaGrassa.perc !== null ? item.massaGrassa.perc + '% / ' + (item.massaGrassa.kg !== null ? item.massaGrassa.kg + ' kg' : '--') : '--'}&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;&lt;strong&gt;Massa Magra:&lt;/strong&gt; ${item.massaMagra.perc !== null ? item.massaMagra.perc + '% / ' + (item.massaMagra.kg !== null ? item.massaMagra.kg + ' kg' : '--') : '--'}&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;&lt;strong&gt;Massa Ossea:&lt;/strong&gt; ${item.massaOssea.perc !== null ? item.massaOssea.perc + '% / ' + (item.massaOssea.kg !== null ? item.massaOssea.kg + ' kg' : '--') : '--'}&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;&lt;strong&gt;Massa Acqua:&lt;/strong&gt; ${item.massaAcqua.perc !== null ? item.massaAcqua.perc + '% / ' + (item.massaAcqua.kg !== null ? item.massaAcqua.kg + ' kg' : '--') : '--'}&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;&lt;strong&gt;Esercizio:&lt;/strong&gt; ${item.esercizio.tipo || '--'} (${item.esercizio.tempo !== null ? item.esercizio.tempo + ' min' : '--'}, ${item.esercizio.quantita || '--'})&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;&lt;strong&gt;Intensità Percepita:&lt;/strong&gt; ${item.esercizio.intensita || '--'}&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;&lt;strong&gt;Calorie:&lt;/strong&gt; ${item.dieta.calorie !== null ? item.dieta.calorie + ' kcal' : '--'}&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;&lt;strong&gt;Macro:&lt;/strong&gt; G: ${item.dieta.grassi !== null ? item.dieta.grassi + 'g' : '--'}, P: ${item.dieta.proteine !== null ? item.dieta.proteine + 'g' : '--'}, C: ${item.dieta.carboidrati !== null ? item.dieta.carboidrati + 'g' : '--'}&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;&lt;strong&gt;Litri Bevuti:&lt;/strong&gt; ${item.dieta.litriBevuti !== null ? item.dieta.litriBevuti + 'L' : '--'}&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;&lt;strong&gt;Creatina:&lt;/strong&gt; ${item.creatina ? 'Sì' : 'No'}&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;&lt;strong&gt;Note:&lt;/strong&gt; ${item.notePersonali || '--'}&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;hr class="my-2 border-gray-300"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;&lt;strong&gt;Obiettivo Acqua:&lt;/strong&gt; ${waterPerc !== '--' ? waterPerc.toFixed(1) + '%' : '--'}&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;&lt;strong&gt;Obiettivo Calorie:&lt;/strong&gt; ${kcalPerc !== '--' ? kcalPerc.toFixed(1) + '%' : '--'}&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;&lt;strong&gt;Obiettivo Proteine:&lt;/strong&gt; ${proteinPerc !== '--' ? proteinPerc.toFixed(1) + '%' : '--'}&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;&lt;strong&gt;Obiettivo Carboidrati:&lt;/strong&gt; ${carbsPerc !== '--' ? carbsPerc.toFixed(1) + '%' : '--'}&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;&lt;strong&gt;Obiettivo Grassi:&lt;/strong&gt; ${fatsPerc !== '--' ? fatsPerc.toFixed(1) + '%' : '--'}&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/ul&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>historyContainer.appendChild(dayCard);</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Funzione per aggiornare i grafici</p>
<p class="p1"><span class="Apple-converted-space">        </span>function updateCharts(data) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (data.length === 0) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Ordina i dati per data crescente per i grafici</p>
<p class="p1"><span class="Apple-converted-space">            </span>const sortedData = data.sort((a, b) =&gt; new Date(a.data) - new Date(b.data));</p>
<p class="p1"><span class="Apple-converted-space">            </span>const labels = sortedData.map(item =&gt; item.data);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const weightData = sortedData.map(item =&gt; item.peso);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const massaGrassaData = sortedData.map(item =&gt; item.massaGrassa.perc);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const massaMagraData = sortedData.map(item =&gt; item.massaMagra.perc);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const calorieData = sortedData.map(item =&gt; item.dieta.calorie);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const proteinData = sortedData.map(item =&gt; item.dieta.proteine);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const carbsData = sortedData.map(item =&gt; item.dieta.carboidrati);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const fatsData = sortedData.map(item =&gt; item.dieta.grassi);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const waterData = sortedData.map(item =&gt; item.dieta.litriBevuti);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Chart per Peso e Masse Corporee</p>
<p class="p1"><span class="Apple-converted-space">            </span>const weightCtx = document.getElementById('weight-chart').getContext('2d');</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (weightChart) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>weightChart.destroy();</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>weightChart = new Chart(weightCtx, {</p>
<p class="p1"><span class="Apple-converted-space">                </span>type: 'line',</p>
<p class="p1"><span class="Apple-converted-space">                </span>data: {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>labels: labels,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>datasets: [</p>
<p class="p1"><span class="Apple-converted-space">                        </span>{</p>
<p class="p1"><span class="Apple-converted-space">                            </span>label: 'Peso (kg)',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>data: weightData,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>borderColor: '#6366f1',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>backgroundColor: 'rgba(99, 102, 241, 0.2)',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>fill: true,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>tension: 0.2</p>
<p class="p1"><span class="Apple-converted-space">                        </span>},</p>
<p class="p1"><span class="Apple-converted-space">                        </span>{</p>
<p class="p1"><span class="Apple-converted-space">                            </span>label: 'Massa Grassa (%)',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>data: massaGrassaData,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>borderColor: '#ef4444',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>backgroundColor: 'rgba(239, 68, 68, 0.2)',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>fill: true,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>tension: 0.2</p>
<p class="p1"><span class="Apple-converted-space">                        </span>},</p>
<p class="p1"><span class="Apple-converted-space">                         </span>{</p>
<p class="p1"><span class="Apple-converted-space">                            </span>label: 'Massa Magra (%)',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>data: massaMagraData,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>borderColor: '#22c55e',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>backgroundColor: 'rgba(34, 197, 94, 0.2)',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>fill: true,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>tension: 0.2</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>]</p>
<p class="p1"><span class="Apple-converted-space">                </span>},</p>
<p class="p1"><span class="Apple-converted-space">                </span>options: {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>responsive: true,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>scales: {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>y: {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>beginAtZero: false</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Chart per Dieta</p>
<p class="p1"><span class="Apple-converted-space">            </span>const dietCtx = document.getElementById('diet-chart').getContext('2d');</p>
<p class="p1"><span class="Apple-converted-space">             </span>if (dietChart) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>dietChart.destroy();</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>dietChart = new Chart(dietCtx, {</p>
<p class="p1"><span class="Apple-converted-space">                </span>type: 'line',</p>
<p class="p1"><span class="Apple-converted-space">                </span>data: {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>labels: labels,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>datasets: [</p>
<p class="p1"><span class="Apple-converted-space">                        </span>{</p>
<p class="p1"><span class="Apple-converted-space">                            </span>label: 'Calorie (kcal)',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>data: calorieData,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>borderColor: '#fbbf24',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>backgroundColor: 'rgba(251, 191, 36, 0.2)',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>fill: false,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>tension: 0.2</p>
<p class="p1"><span class="Apple-converted-space">                        </span>},</p>
<p class="p1"><span class="Apple-converted-space">                        </span>{</p>
<p class="p1"><span class="Apple-converted-space">                            </span>label: 'Proteine (g)',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>data: proteinData,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>borderColor: '#3b82f6',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>backgroundColor: 'rgba(59, 130, 246, 0.2)',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>fill: false,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>tension: 0.2</p>
<p class="p1"><span class="Apple-converted-space">                        </span>},</p>
<p class="p1"><span class="Apple-converted-space">                        </span>{</p>
<p class="p1"><span class="Apple-converted-space">                            </span>label: 'Carboidrati (g)',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>data: carbsData,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>borderColor: '#8b5cf6',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>backgroundColor: 'rgba(139, 92, 246, 0.2)',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>fill: false,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>tension: 0.2</p>
<p class="p1"><span class="Apple-converted-space">                        </span>},</p>
<p class="p1"><span class="Apple-converted-space">                        </span>{</p>
<p class="p1"><span class="Apple-converted-space">                            </span>label: 'Grassi (g)',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>data: fatsData,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>borderColor: '#d946ef',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>backgroundColor: 'rgba(217, 70, 239, 0.2)',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>fill: false,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>tension: 0.2</p>
<p class="p1"><span class="Apple-converted-space">                        </span>},</p>
<p class="p1"><span class="Apple-converted-space">                        </span>{</p>
<p class="p1"><span class="Apple-converted-space">                            </span>label: 'Acqua (L)',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>data: waterData,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>borderColor: '#06b6d4',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>backgroundColor: 'rgba(6, 182, 212, 0.2)',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>fill: false,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>tension: 0.2</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>]</p>
<p class="p1"><span class="Apple-converted-space">                </span>},</p>
<p class="p1"><span class="Apple-converted-space">                </span>options: {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>responsive: true,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>scales: {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>y: {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>beginAtZero: false</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>getSummaryBtn.addEventListener('click', async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!auth.currentUser) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>showMessage("Attendere l'autenticazione per generare il riassunto.", true);</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>aiSummaryCard.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>aiSummaryContent.innerHTML = '&lt;p class="text-center text-gray-500"&gt;Analisi in corso... ✨&lt;/p&gt;';</p>
<p class="p1"><span class="Apple-converted-space">            </span>getSummaryBtn.disabled = true;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                </span>// Fetch recent data to summarize</p>
<p class="p1"><span class="Apple-converted-space">                </span>const dailyDocs = await getDocs(collection(db, `artifacts/${appId}/users/${auth.currentUser.uid}/dailyEntries`));</p>
<p class="p1"><span class="Apple-converted-space">                </span>const historyData = [];</p>
<p class="p1"><span class="Apple-converted-space">                </span>dailyDocs.forEach(doc =&gt; historyData.push(doc.data()));</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Sort by date and get a reasonable number of recent entries</p>
<p class="p1"><span class="Apple-converted-space">                </span>historyData.sort((a, b) =&gt; new Date(a.data) - new Date(b.data));</p>
<p class="p1"><span class="Apple-converted-space">                </span>const recentData = historyData.slice(-14); // Last 14 days</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const userGoals = {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>initialWeight: initialWeight,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>targetWeightLoss: targetWeightLoss,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>dailyCaloriesGoal: dailyCaloriesGoal,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>dailyProteinGoal: dailyProteinGoal,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>dailyCarbsGoal: dailyCarbsGoal,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>dailyFatsGoal: dailyFatsGoal,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>dailyWaterGoal: dailyWaterGoal,</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>const initialPrompt = `Analizza i seguenti dati di fitness e dieta e fornisci un riassunto motivazionale e actionable. Valuta il mio progresso in relazione ai miei obiettivi e offri suggerimenti specifici per migliorare.</p>
<p class="p2"><br></p>
<p class="p1">I miei obiettivi:</p>
<p class="p1">Perdita peso totale: ${userGoals.targetWeightLoss} kg</p>
<p class="p1">Peso iniziale: ${userGoals.initialWeight} kg</p>
<p class="p1">Obiettivo calorico: ${userGoals.dailyCaloriesGoal} kcal</p>
<p class="p1">Obiettivo proteine: ${userGoals.dailyProteinGoal} g</p>
<p class="p1">Obiettivo carboidrati: ${userGoals.dailyCarbsGoal} g</p>
<p class="p1">Obiettivo grassi: ${userGoals.dailyFatsGoal} g</p>
<p class="p1">Obiettivo acqua: ${userGoals.dailyWaterGoal} L</p>
<p class="p2"><br></p>
<p class="p1">I miei dati recenti (ultimi 14 giorni):</p>
<p class="p1">${JSON.stringify(recentData, null, 2)}</p>
<p class="p1">`;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>const systemPrompt = "Sei un personal trainer e un analista di dati. La tua risposta deve essere in italiano, amichevole e motivazionale. Analizza i dati forniti dall'utente e fornisci un riassunto conciso dei suoi progressi, evidenziando successi e aree di miglioramento. Evita di usare tecnicismi e concentrati su un linguaggio semplice e incoraggiante. Includi un consiglio pratico per la prossima settimana.";</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const payload = {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>contents: [{ parts: [{ text: initialPrompt }] }],</p>
<p class="p1"><span class="Apple-converted-space">                    </span>tools: [{ "google_search": {} }],</p>
<p class="p1"><span class="Apple-converted-space">                    </span>systemInstruction: {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>parts: [{ text: systemPrompt }]</p>
<p class="p1"><span class="Apple-converted-space">                    </span>},</p>
<p class="p1"><span class="Apple-converted-space">                    </span>generationConfig: {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>temperature: 0.7,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>topP: 1,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>topK: 1</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const apiKey = "";<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const response = await fetch(apiUrl, {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>method: 'POST',</p>
<p class="p1"><span class="Apple-converted-space">                    </span>headers: { 'Content-Type': 'application/json' },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>body: JSON.stringify(payload)</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>if (!response.ok) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>throw new Error(`HTTP error! status: ${response.status}`);</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const result = await response.json();</p>
<p class="p1"><span class="Apple-converted-space">                </span>const generatedText = result?.candidates?.[0]?.content?.parts?.[0]?.text;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>if (generatedText) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>aiSummaryContent.innerHTML = `&lt;div class="prose"&gt;${generatedText.replace(/\n/g, '&lt;br&gt;')}&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>showMessage("Analisi completata!", false);</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>aiSummaryContent.textContent = "Non è stato possibile generare l'analisi. Riprova più tardi.";</p>
<p class="p1"><span class="Apple-converted-space">                    </span>showMessage("Errore nella generazione del riassunto.", true);</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.error('Errore nella generazione del riassunto:', error);</p>
<p class="p1"><span class="Apple-converted-space">                </span>aiSummaryContent.textContent = `Errore: ${error.message}. Non è stato possibile generare l'analisi.`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>showMessage("Errore nella generazione del riassunto.", true);</p>
<p class="p1"><span class="Apple-converted-space">            </span>} finally {</p>
<p class="p1"><span class="Apple-converted-space">                </span>getSummaryBtn.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Esegui l'inizializzazione al caricamento della pagina</p>
<p class="p1"><span class="Apple-converted-space">        </span>window.onload = function () {</p>
<p class="p1"><span class="Apple-converted-space">            </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                </span>app = initializeApp(firebaseConfig);</p>
<p class="p1"><span class="Apple-converted-space">                </span>db = getFirestore(app);</p>
<p class="p1"><span class="Apple-converted-space">                </span>auth = getAuth(app);</p>
<p class="p1"><span class="Apple-converted-space">                </span>setLogLevel('debug');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>onAuthStateChanged(auth, async (user) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (user) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>userId = user.uid;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>userIdDisplay.textContent = userId;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                        </span>// Carica le impostazioni utente</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const settingsDocRef = doc(db, `artifacts/${appId}/users/${userId}/settings`, 'userProfile');</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const settingsSnap = await getDoc(settingsDocRef);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (settingsSnap.exists()) {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>const settingsData = settingsSnap.data();</p>
<p class="p1"><span class="Apple-converted-space">                            </span>userHeight = settingsData.altezza;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>initialWeight = settingsData.initialWeight || null;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>dailyWaterGoal = settingsData.dailyWaterGoal || null;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>dailyCaloriesGoal = settingsData.dailyCaloriesGoal || null;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>dailyProteinGoal = settingsData.dailyProteinGoal || null;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>dailyCarbsGoal = settingsData.dailyCarbsGoal || null;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>dailyFatsGoal = settingsData.dailyFatsGoal || null;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                            </span>// Popola i campi di input</p>
<p class="p1"><span class="Apple-converted-space">                            </span>altezzaInput.value = userHeight || '';</p>
<p class="p1"><span class="Apple-converted-space">                            </span>dailyWaterGoalInput.value = dailyWaterGoal || '';</p>
<p class="p1"><span class="Apple-converted-space">                            </span>dailyCaloriesGoalInput.value = dailyCaloriesGoal || '';</p>
<p class="p1"><span class="Apple-converted-space">                            </span>dailyProteinGoalInput.value = dailyProteinGoal || '';</p>
<p class="p1"><span class="Apple-converted-space">                            </span>dailyCarbsGoalInput.value = dailyCarbsGoal || '';</p>
<p class="p1"><span class="Apple-converted-space">                            </span>dailyFatsGoalInput.value = dailyFatsGoal || '';</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                        </span>// Avvia i listener e carica i dati giornalieri</p>
<p class="p1"><span class="Apple-converted-space">                        </span>fetchDailyDataForDate(selectedDate);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>setupDailyDataListener();</p>
<p class="p1"><span class="Apple-converted-space">                        </span>setupWeeklyDataListener();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>userId = null;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>await signInAnonymously(auth);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>console.error("Errore nell'autenticazione anonima:", error);</p>
<p class="p1"><span class="Apple-converted-space">                            </span>showMessage("Errore di autenticazione. Riprova più tardi.", true);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>if (initialAuthToken) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>signInWithCustomToken(auth, initialAuthToken).catch(async (error) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>console.error("Errore nell'autenticazione con token personalizzato:", error);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>await signInAnonymously(auth);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>} catch (anonError) {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>console.error("Errore nel fallback all'autenticazione anonima:", anonError);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>});</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>signInAnonymously(auth).catch((error) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>console.error("Errore nell'autenticazione anonima:", error);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>});</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>} catch (e) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.error("Errore nell'inizializzazione di Firebase:", e);</p>
<p class="p1"><span class="Apple-converted-space">                </span>showMessage("Errore: Impossibile connettersi al database.", true);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
